<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Affan AI Assistant</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      background: radial-gradient(circle at top, #f8f4f4 0%, #121213 50%);
      font-family: "Inter", sans-serif;
    }
    .glass {
      background: rgb(10, 10, 10);
      backdrop-filter: blur(12px);
      border: 1px solid #ffffff;
    }
    .typing-dot {
      width: 8px;
      height: 8px;
      background-color: #a3bffa;
      border-radius: 50%;
      display: inline-block;
      margin: 0 3px;
      animation: blink 1s infinite alternate;
    }
    @keyframes blink {
      from { opacity: 0.2; }
      to { opacity: 1; }
    }
  </style>
</head>
<body class="flex items-center justify-center min-h-screen text-white">

  <div class="w-full max-w-xl h-[85vh] flex flex-col glass rounded-3xl shadow-2xl overflow-hidden">
    <!-- Header -->
    <div class="flex items-center justify-between border-b border-white/10 px-5 py-4">
      <div class="flex items-center gap-3">
        <img src="https://cdn-icons-png.flaticon.com/512/4712/4712109.png" alt="bot" class="w-10 h-10 rounded-full">
        <h1 class="text-xl font-semibold tracking-wide">Affan AI Assistant ðŸ¤–</h1>
      </div>
      <button id="mute-btn" class="bg-white/10 hover:bg-white/20 px-3 py-2 rounded-lg text-sm">ðŸ”Š Voice On</button>
    </div>

    <!-- Chat -->
    <div id="chat-box" class="flex-1 overflow-y-auto px-5 py-4 space-y-4">
      <div class="flex justify-start">
        <div class="bg-white/10 px-4 py-2 rounded-2xl max-w-[80%]">
          ðŸ‘‹ Hi, Iâ€™m <b>Affan AI</b>. Upload a file, photo, or ask me anything.
        </div>
      </div>
    </div>

    <!-- Input -->
    <div class="p-4 border-t border-white/10 bg-transparent flex items-center gap-3">
      <label for="file-upload" class="cursor-pointer">
        <img src="https://cdn-icons-png.flaticon.com/512/747/747968.png" alt="upload" class="w-7 h-7 opacity-80 hover:opacity-100">
      </label>
      <input id="file-upload" type="file" class="hidden" accept="image/*,.txt,.pdf,.docx,.xlsx" />

      <input id="user-input" type="text" placeholder="Type a message..."
        class="flex-1 px-4 py-3 bg-white/10 rounded-xl text-white placeholder-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500">
      <button id="send-btn" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-xl font-semibold transition">Send</button>
    </div>
  </div>

  <script>
const GEMINI_API_KEY = "AIzaSyCNZXhVbn9p5-kKeIC3b0UCubmIn1gYOnQ"; // ðŸ”‘ Replace this
    const GEMINI_URL =
  `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${GEMINI_API_KEY}`;

    const chatBox = document.getElementById("chat-box");
    const userInput = document.getElementById("user-input");
    const sendBtn = document.getElementById("send-btn");
    const fileUpload = document.getElementById("file-upload");
    const muteBtn = document.getElementById("mute-btn");

    let isMuted = false; // ðŸŽ§ Voice toggle

    sendBtn.addEventListener("click", sendMessage);
    userInput.addEventListener("keypress", (e) => e.key === "Enter" && sendMessage());
    fileUpload.addEventListener("change", handleFileUpload);
    muteBtn.addEventListener("click", toggleMute);

    function appendMessage(sender, message, isImage = false) {
      const div = document.createElement("div");
      div.className = sender === "user" ? "flex justify-end" : "flex justify-start";

      const bubble = document.createElement("div");
      bubble.className =
        sender === "user"
          ? "bg-blue-600 px-4 py-2 rounded-2xl max-w-[80%] shadow-md"
          : "bg-white/10 px-4 py-2 rounded-2xl max-w-[80%] shadow-md";

      if (isImage) {
        const img = document.createElement("img");
        img.src = message;
        img.className = "rounded-lg max-w-[200px]";
        bubble.appendChild(img);
      } else {
        bubble.innerText = message;
      }

      div.appendChild(bubble);
      chatBox.appendChild(div);
      chatBox.scrollTop = chatBox.scrollHeight;
    }

    function showTyping() {
      const div = document.createElement("div");
      div.id = "typing";
      div.className = "flex justify-start items-center gap-2";
      div.innerHTML = `
        <div class='bg-white/10 px-4 py-2 rounded-2xl flex gap-1'>
          <span class='typing-dot'></span>
          <span class='typing-dot'></span>
          <span class='typing-dot'></span>
        </div>`;
      chatBox.appendChild(div);
      chatBox.scrollTop = chatBox.scrollHeight;
    }

    function removeTyping() {
      const typing = document.getElementById("typing");
      if (typing) typing.remove();
    }

    async function sendMessage() {
      const text = userInput.value.trim();
      if (!text) return;

      appendMessage("user", text);
      userInput.value = "";
      showTyping();

      try {
        const res = await fetch(GEMINI_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            contents: [{ role: "user", parts: [{ text }] }],
          }),
        });

        const data = await res.json();
        removeTyping();

        let reply =
          data?.candidates?.[0]?.content?.parts?.[0]?.text ||
          "âš ï¸ No response from Gemini.";

        // Remove markdown symbols
        reply = reply.replace(/[#*_`]/g, "").trim();

        appendMessage("bot", reply);
        if (!isMuted) speak(reply);
      } catch (err) {
        removeTyping();
        appendMessage("bot", "âŒ Error connecting to Gemini API");
        console.error(err);
      }
    }

    function speak(text) {
      const speech = new SpeechSynthesisUtterance(text);
      speech.lang = "en-US";
      speech.rate = 1;
      speech.pitch = 1;
      window.speechSynthesis.speak(speech);
    }

    function toggleMute() {
      isMuted = !isMuted;
      muteBtn.textContent = isMuted ? "ðŸ”‡ Muted" : "ðŸ”Š Voice On";
      muteBtn.classList.toggle("bg-red-500", isMuted);
      muteBtn.classList.toggle("bg-white/10", !isMuted);
    }

    function handleFileUpload(event) {
      const file = event.target.files[0];
      if (!file) return;

      if (file.type.startsWith("image/")) {
        const reader = new FileReader();
        reader.onload = (e) => appendMessage("user", e.target.result, true);
        reader.readAsDataURL(file);
      } else {
        appendMessage("user", `ðŸ“Ž Uploaded: ${file.name}`);
      }

      fileUpload.value = "";
    }
  </script>
</body>
</html>
